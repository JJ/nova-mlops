<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>MlOps@Nova by JJ Merelo: Session 1</title>
    
    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/mlops-preso.css">
    <link rel="stylesheet" href="dist/extra.css">
    <link rel="stylesheet" href="dist/mlops.css">
    
    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
	<section>
          <h2>Second session: git for the masses, scraping and testing</h2>
          <h1>MLOps at Nova</h1>
          <h3>JJ Merelo, <a href="https://twitter.com/jjmerelo"><code>@jjmerelo</code></a></h3>
        </section>

	<section><h1>What did you learn yesterday</h1>
	  <h2 class='fragment'>Is there some left over work
	    from yesterday's sprint</h2>
	  <h3 class='fragment'>Ready to start next
	    MVP/milestone?</h3>
	</section>
	
	<section><!-- ETL -->

	  <section><h1>The truth is out there</h1>
	    <h2 class='fragment'>It's hard to bring it in here</h2>
	  </section>

	  <section>
	    <h1>Scraping will be needed</h1>
	    <h2 class='fragment'>Use the API or open data if
	      (easily) available</h2>
	    <aside class='notes'>Scraping extracts
	      information from web sites, using different
	      techniques. But the essential part is almost
	      never passing from content to data, but getting
	      the content. API and open data are great, but
	      sometimes they have restrictions.
	    </aside>
	  </section>

	  <sections><h1>This is a different module</h1>
	    <h2 class='fragment'>Use any language you
	      want</h2>
	    <aside class='notes'>Remember one of the
	      principles: you will need many languages for a
	      great ML workflow</aside>
	  </sections>
	  
	  <section><h2>Two phases</h2>
	    <h1 class='fragment'>Download content</h1>
	    <h1 class='fragment'>Extract content</h1>

	    <aside class='notes'>And, obviously, eventually process content.</aside>
	  </section>
	  
	  <section><h1>Before downloading, identify URL</h1>
	    <h2 class='fragment'>Scrape for links, or find regularities</h2>
	  </section>
	  
	  <section><h1>Portuguese INE is hard</h1>
	    
	    <pre><code data-line-numbers='1,3,4|2,5,6'>    const browser = await puppeteer.launch();
    const page = await browser.newPage();
    await page.goto(url);
    await page.content();
    const frame = await page.frames()[1];
    const content = await frame.content();
		      </code></pre>
		      <aside class='notes'>First code... URL is not available in the
		      page source, you need to click to get it, and it
			loads a frame. However, it can be done. We're
		      using here a Deno module called puppeteer,
		      which  handles a browser, behaving more or less
		      like one. This is often called a "headless"
		      browser, and it's incredibly useful.</aside>
		    </section>

		    <section><h1>Download content</h1>
		      <h2 class='fragment'>From <code>curl</code> to mocking browsers</h2>
		      <h3 class='fragment'>Data does not want to be scraped</h3>
		    </section>

		    <section><h1>Sometimes it's easier...</h1>
		      <pre><code data-line-numbers='1,5|2,5'>use LWP::Simple;
use constant OSK_URL => 'https://www.oryxspioenkop.com/2022/02/attack-on-europe-documenting-equipment.html';
sub download_osk {
  my $dl =get(OSK_URL) or die "Can't download " . OSK_URL;
  return $dl;
}
		      </code></pre>
		      <aside class='notes'>Written in Perl, it simply
			downloads the page</aside>
		    </section>

		    <section><h1>Use source control also!</h1>
		      <h2 class='aside'>Date and cache</h2>
		      <h3 class='aside'>Download only once!</h3>
		    </section>
		    <section><h1>Have a plan B</h1>
		      <h2 class='fragment'>Nothing is guaranteed to work</h2>
		      <h3 class='fragment'>And nothing is guaranteed to work <em>for ever</em></h3>
		      <aside class='fragment'>After working for a
		      month or more, the Ukr MoD site started to
		      request a captcha, which is impossible to
		      overcome. At the end of the day, it's a fight
		      human vs technology and human vs. human; you
		      need to invest yourself in the fight... or be
			defeated.
		      </aside>
		    </section>

		    <section><h1>ðŸ’¼ Activity</h1>
		      <h2>Identify feasible data sources, and create a
			milestone for downloading and extracting it</h2>
		      <h3 class='fragment'>Use your own data, open
			data portals, official web pages.</h3>
		      <h3>Start organizing the task of working with that source of data, and schedule updates</h3>
		      <h3>Effectively write a downloader</h3>
		  </section>

	</section>

	<section> <!-- Learn about dependency managers -->

	  <section><h1>MLOps is about <em>repeatable</em> worlflows</h1>
	    <h2 class='fragment'>There should be a single way of describing dependencies</h2>
	  </section>

	  <section><h1>Use best practices dependency management</h1>
	    <h2 class='fragment'>Use <code>poetry</code></h2>
	  </section>

	  <section><h1>Poetry for my data</h1>
	    <pre><code data-line-numbers='1,8|1-6|8-14|9'>[tool.poetry]
name = "nova_mlops"
version = "0.1.0"
description = "Example for NOVA MLOps course"
authors = ["JJ Merelo &lt;jjmerelo@gmail.com>"]
license = "GPL 3.0"

[tool.poetry.dependencies]
python = "^3.9"
neptune-client = "^0.16.2"
python-dotenv = "^0.20.0"
mlflow = "^1.27.0"
numpy = "^1.23.0"</code></pre>
	  </section>

	  <section><h1>Dependency managers become task managers</h1>
	    <h2 class='fragment'>Tasks managed for you</h2>
	  </section>

	  <section><h1>Tasks managers manage your workflows</h1>
	    <h2 class='fragment'>So that you need not do it</h2>
	  </section>

	  <section><h1>Poetry in motion</h1>
	    <pre><code>[tool.poetry.scripts]
train = 'nova_mlops.__init__:go'
	    </code></pre>

	    <pre class='fragment'><code>poetry run train</code></pre>
	  </section>

	  <section><h3>ðŸ’¼ Activity</h3>
	    <h3>Start a module in the chosen language</h3>
	    <ul>
	      <li>Look for the proper directory layout and naming conventions</li>
	      <li>Declare dependencies, and install them</li>
	      <li>Choose a task manager, and create a simple running task</li>
	    </ul>
	    <aside class='notes'>Working witht the previous downloader</aside>
	  </section>
	</section>

	<section>
	  <section><h1>And now... the tests</h1>
	    <h2 class='fragment'>Tests are essential in DevOps/MLOps</h2>
	  </section>

	  <section><h1>Unit tests ensure that every pipeline step works</h1>
	    <h2 class='fragment'>Thus delivering value to client</h2>
	  </section>

	  <section><h1>Choose wisely your test tools</h1>
	    <aside class='notes'>One of the principles of the course:
	    learn to decide. Agile is about focusing on the client,
	    which is the result, but also focusing on adaptability,
	    meaning that tools should allow you to adapt to new
	    circumstances and should not detract value (by being
	    insecure, or deprecated, or simply not delivering as much
	    value as others)</aside>
	  </section>

	  <section><h1>Testing behaviors</h1>
	    <h2 class='fragment'>Does download work?</h2>
	    <pre><code data-line-number='1,2|4-6|11-12'>import pytest
from .. import download, driver

@pytest.fixture
def page():
    return download(14,4)

def test_driver():
    assert driver

def test_download(page):
    assert page
	    </code></pre>
	  </section>

	  <section><h1>ðŸ’¼ Activity</h1>
	    <h2>Add your tests</h2>
	    <h3 class='fragment'>Add a target to the task manager that
	      runs tests</h3>
	    <aside class='notes'>In many cases, it will be totally
	      automatic, in others you will need to add it yourself.</aside>
	  </section>

	</section>
	
	<section>
	  <section><h1>Extract data</h1>
	    <h2 class='fragment'>DOM or regular expression</h2>
	    <h3 class='fragment'>Often, a combination of both</h3>
	  </section>
	  
	  <section><h1>Also... have a plan B</h1>
	    <h2 class='fragment'>Nothing is guaranteed to work</h2>
	    <h3 class='fragment'>And nothing is guaranteed to work <em>for ever</em></h3>
	    <aside class='fragment'>After working for a
	      month or more, the Ukr MoD site started to
	      request a captcha, which is impossible to
	      overcome. At the end of the day, it's a fight
	      human vs technology and human vs. human; you
	      need to invest yourself in the fight... or be
	      defeated.
	    </aside>
	  </section>
        </section>

	    </div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>Reveal.initialize({
	     hash: true,
             width: "95%",
             height: '100%',
             controls: true,
             progress: true,
             backgroundTransition: 'convex',
	     // Learn about plugins: https://revealjs.com/plugins/
	     plugins: [ RevealHighlight, RevealNotes ]
	 });
	</script>
	</body>
</html>
